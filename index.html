<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="google-site-verification" content="33MVfLbupQdh7gMotWJ0SIXwX93Su6FDIqm04Y64qtg" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowTask | Your Productivity Companion</title>
    <style>
        :root {
            --primary: #7c3aed;
            --primary-light: #8b5cf6;
            --primary-dark: #6d28d9;
            --text: #1f2937;
            --text-light: #6b7280;
            --bg: #f9fafb;
            --card-bg: #ffffff;
            --border: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --tag-bg: #e5e7eb;
            --tag-bg-hover: #d1d5db;
        }

        body.dark-mode {
            --text: #e5e7eb;
            --text-light: #9ca3af;
            --bg: #111827;
            --card-bg: #1f2937;
            --border: #374151;
            --tag-bg: #3f3f46;
            --tag-bg-hover: #4b5563;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* Front Page */
        .front-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            position: relative;
            overflow: hidden;
        }

        .front-page::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(124, 58, 237, 0.1) 0%, rgba(124, 58, 237, 0) 70%);
            z-index: 0;
        }

        .logo {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 1.5rem;
            z-index: 1;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-light);
            margin-bottom: 2.5rem;
            max-width: 80%;
            margin-left: auto;
            margin-right: auto;
        }

        .btn {
            padding: 1rem 2.5rem;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .features {
            display: flex;
            gap: 2.5rem;
            margin-top: 5rem;
            flex-wrap: wrap;
            justify-content: center;
            z-index: 1;
        }

        .feature {
            flex: 1;
            min-width: 240px;
            max-width: 280px;
            padding: 2rem 1.75rem;
            background-color: var(--card-bg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .feature:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(124, 58, 237, 0.2);
        }

        .feature-icon::before {
            font-size: 2.25rem;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 1.25rem;
            display: block;
        }

        .feature h3 {
            margin-bottom: 0.75rem;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .feature p {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        /* Dashboard */
        .dashboard {
            display: none;
            min-height: 100vh;
            flex-direction: row;
        }

        .sidebar {
            width: 280px;
            background-color: var(--card-bg);
            border-right: 1px solid var(--border);
            padding: 2rem 1.5rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 10;
        }

        .sidebar-header {
            margin-bottom: 2.5rem;
        }

        .sidebar-logo {
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--primary);
        }

        .nav-menu {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.85rem 1.25rem;
            border-radius: var(--radius-sm);
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .nav-link:hover, .nav-link.active {
            background-color: rgba(124, 58, 237, 0.08);
            color: var(--primary);
        }

        .nav-link .badge {
            margin-left: auto;
            background-color: var(--primary);
            color: white;
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 999px;
        }

        .main-content {
            margin-left: 280px;
            padding: 3rem;
            max-width: 900px;
            margin: 0 auto;
            padding-left: 310px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
        }

        .greeting h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .greeting p {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .greeting p strong {
            color: var(--primary);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            border: 2px solid var(--border);
        }

        .user-avatar:hover {
            transform: scale(1.05);
            border-color: var(--primary);
        }

        .task-input-container {
            margin-bottom: 2.5rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .task-input, .task-tags, .task-duedate, .task-priority, .task-depends {
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 1rem;
            background-color: var(--card-bg);
        }

        .task-input:focus, .task-tags:focus, .task-duedate:focus, .task-priority:focus, .task-depends:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
        }

        .task-input { flex-grow: 1; }
        .task-tags { width: 200px; }
        .task-duedate { width: 150px; }
        .task-priority, .task-depends { width: 120px; }

        .task-btn-add {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
        }

        .task-btn-add:hover {
            background: var(--primary-dark);
        }

        .task-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 1.25rem;
            background-color: var(--card-bg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .task-item:hover {
            box-shadow: var(--shadow-md);
            border-color: rgba(124, 58, 237, 0.2);
            transform: translateY(-1px);
        }

        .task-item.dragging {
            opacity: 0.6;
            box-shadow: 0 0 20px var(--primary);
        }

        .task-checkbox {
            margin-right: 1.25rem;
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
        }

        .task-text {
            flex: 1;
            font-size: 1.05rem;
            font-weight: 500;
        }

        .task-text.completed {
            text-decoration: line-through;
            color: var(--text-light);
            opacity: 0.8;
        }

        .task-category, .task-tag {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            background-color: rgba(124, 58, 237, 0.1);
            color: var(--primary);
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .task-duedate {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .task-duedate.overdue {
            color: var(--danger);
            font-weight: 600;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
        }

        .task-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .task-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .task-btn.edit:hover { color: var(--warning); }
        .task-btn.delete:hover { color: var(--danger); }

        .task-details {
            width: 100%;
            margin-top: 0.5rem;
            display: none;
            flex-direction: column;
            gap: 0.5rem;
        }

        .task-details.open {
            display: flex;
        }

        .task-notes {
            font-size: 0.9rem;
            color: var(--text-light);
            background: var(--tag-bg);
            padding: 0.5rem;
            border-radius: var(--radius-sm);
        }

        .subtask-list {
            list-style: none;
            padding: 0;
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            padding: 0.3rem 0;
        }

        .subtask-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }

        .add-subtask-container {
            display: flex;
            gap: 0.5rem;
        }

        .add-subtask-input {
            flex-grow: 1;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
        }

        .add-subtask-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
        }

        .task-dependencies {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .task-dependencies span {
            background: var(--tag-bg);
            padding: 0.2rem 0.5rem;
            border-radius: var(--radius-sm);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .stat-card .progress {
            height: 6px;
            background-color: var(--border);
            border-radius: 999px;
            margin-top: 1rem;
        }

        .stat-card .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            border-radius: 999px;
        }

        .settings-panel {
            position: fixed;
            top: 0;
            right: -320px;
            width: 320px;
            height: 100%;
            background: var(--card-bg);
            box-shadow: -2px 0 8px rgba(0,0,0,0.15);
            padding: 1.5rem;
            transition: right 0.4s ease;
            z-index: 20;
        }

        .settings-panel.open {
            right: 0;
        }

        .settings-panel h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .settings-close {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
        }

        .settings-panel label {
            display: block;
            margin: 1rem 0 0.3rem;
            font-weight: 600;
        }

        .settings-panel select, .settings-panel input[type="file"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--bg);
            color: var(--text);
        }

        .settings-panel button {
            margin-top: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.6rem 1rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
        }

        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            border: none;
            z-index: 100;
        }

        @media (max-width: 1024px) {
            .sidebar { width: 240px; padding: 1.5rem 1rem; }
            .main-content { margin-left: 240px; padding-left: 270px; }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding: 1.5rem;
            }
            .nav-menu {
                flex-direction: row;
                overflow-x: auto;
                padding-bottom: 0.5rem;
            }
            .nav-link { padding: 0.75rem 1rem; white-space: nowrap; }
            .main-content { margin-left: 0; padding: 2rem 1.5rem; }
            .stats { grid-template-columns: 1fr; }
            .settings-panel { width: 100%; right: -100%; }
            .settings-panel.open { right: 0; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .task-item { animation: fadeIn 0.3s ease forwards; }
        .task-item.completed { animation: fadeComplete 0.5s ease; }
        @keyframes fadeComplete {
            from { opacity: 1; }
            to { opacity: 0.6; }
        }
        .task-list.fade { opacity: 0.3; }
    </style>
</head>
<body>
    <div class="front-page" id="frontPage">
        <div class="logo">FlowTask</div>
        <div class="hero">
            <h1>Clarity Through Simplicity</h1>
            <p>FlowTask helps you focus on what truly matters with an intuitive interface.</p>
            <button class="btn" id="signInBtn">Start Flowing</button>
        </div>
        <div class="features">
            <div class="feature">
                <div class="feature-icon" style="content: '⚡';"></div>
                <h3>Lightning Fast</h3>
                <p>Capture tasks instantly to get back to your work.</p>
            </div>
            <div class="feature">
                <div class="feature-icon" style="content: '🔒';"></div>
                <h3>Privacy First</h3>
                <p>Your tasks stay on your device, no tracking.</p>
            </div>
            <div class="feature">
                <div class="feature-icon" style="content: '🧠';"></div>
                <h3>Smart Organization</h3>
                <p>Categorize tasks with smart suggestions.</p>
            </div>
        </div>
    </div>

    <div class="dashboard" id="dashboard">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">FlowTask</div>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="#" class="nav-link active" data-category="all">All Tasks <span class="badge" id="allTasksCount">0</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-category="today">Today <span class="badge" id="todayTasksCount">0</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-category="upcoming">Upcoming <span class="badge" id="upcomingTasksCount">0</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-category="completed">Completed <span class="badge" id="completedTasksCount">0</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-category="personal">Personal <span class="badge" id="personalTasksCount">0</span></a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-category="work">Work <span class="badge" id="workTasksCount">0</span></a></li>
            </ul>
        </div>
        <div class="main-content">
            <div class="header">
                <div class="greeting">
                    <h1 id="greetingText">Welcome back!</h1>
                    <p>You're <strong id="productivityLevel">very productive</strong> today with <strong id="pendingCount">0</strong> tasks remaining</p>
                </div>
                <div class="user-menu">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <button class="btn" id="openSettings">Settings</button>
                </div>
            </div>
            <div class="stats">
                <div class="stat-card">
                    <h3>Completion Rate</h3>
                    <p id="completionRate">0%</p>
                    <div class="progress"><div class="progress-bar" id="completionBar" style="width: 0%"></div></div>
                </div>
                <div class="stat-card">
                    <h3>Daily Average</h3>
                    <p id="dailyAverage">0 tasks</p>
                    <div class="progress"><div class="progress-bar" style="width: 0%"></div></div>
                </div>
                <div class="stat-card">
                    <h3>Streak</h3>
                    <p id="streakCount">0 days</p>
                    <div class="progress"><div class="progress-bar" style="width: 0%"></div></div>
                </div>
            </div>
            <div class="task-input-container">
                <input type="text" class="task-input" id="taskInput" placeholder="What needs your attention today?">
                <input type="text" class="task-tags" id="taskTags" placeholder="Tags (comma-separated)" list="tagSuggestions">
                <datalist id="tagSuggestions"></datalist>
                <input type="date" class="task-duedate" id="taskDueDate">
                <select class="task-priority" id="taskPriority">
                    <option value="none">Priority</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                </select>
                <select class="task-depends" id="taskDepends">
                    <option value="none">No Dependency</option>
                </select>
                <button class="task-btn-add" id="addTaskBtn">Add</button>
            </div>
            <div class="task-categories">
                <button class="category-btn active" data-category="all">All Tasks</button>
                <button class="category-btn" data-category="personal">Personal</button>
                <button class="category-btn" data-category="work">Work</button>
                <button class="category-btn" data-category="shopping">Shopping</button>
                <button class="category-btn" data-category="health">Health</button>
                <button class="category-btn" data-category="learning">Learning</button>
                <button class="category-btn" data-category="other">Other</button>
            </div>
            <ul class="task-list" id="taskList"></ul>
        </div>
    </div>

    <div class="settings-panel" id="settingsPanel">
        <button class="settings-close" id="settingsClose">×</button>
        <h3>Settings</h3>
        <label for="sortTasks">Sort Tasks By:</label>
        <select id="sortTasks">
            <option value="none">Default</option>
            <option value="priority">Priority</option>
            <option value="due-date">Due Date</option>
            <option value="name">Task Name</option>
        </select>
        <label for="filterPriority">Filter by Priority:</label>
        <select id="filterPriority">
            <option value="all">All</option>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
        </select>
        <label for="filterTags">Filter by Tag:</label>
        <select id="filterTags">
            <option value="all">All</option>
        </select>
        <label>Data Management</label>
        <button id="exportData">Export Data</button>
        <button id="exportTemplate">Export Template</button>
        <label for="importData">Import Data:</label>
        <input type="file" id="importData" accept=".json">
        <label for="importTemplate">Import Template:</label>
        <input type="file" id="importTemplate" accept=".json">
        <button id="clearData">Clear All Data</button>
        <button id="restoreBackup">Restore Last Backup</button>
    </div>

    <button class="theme-toggle" id="themeToggle">🌙</button>

    <script>
        (function () {
            const frontPage = document.getElementById('frontPage');
            const dashboard = document.getElementById('dashboard');
            const signInBtn = document.getElementById('signInBtn');
            const taskInput = document.getElementById('taskInput');
            const taskTags = document.getElementById('taskTags');
            const taskDueDate = document.getElementById('taskDueDate');
            const taskPriority = document.getElementById('taskPriority');
            const taskDepends = document.getElementById('taskDepends');
            const addTaskBtn = document.getElementById('addTaskBtn');
            const taskList = document.getElementById('taskList');
            const themeToggle = document.getElementById('themeToggle');
            const navLinks = document.querySelectorAll('.nav-link');
            const categoryBtns = document.querySelectorAll('.category-btn');
            const userAvatar = document.getElementById('userAvatar');
            const greetingText = document.getElementById('greetingText');
            const productivityLevel = document.getElementById('productivityLevel');
            const pendingCount = document.getElementById('pendingCount');
            const completionRate = document.getElementById('completionRate');
            const completionBar = document.getElementById('completionBar');
            const dailyAverage = document.getElementById('dailyAverage');
            const streakCount = document.getElementById('streakCount');
            const allTasksCount = document.getElementById('allTasksCount');
            const todayTasksCount = document.getElementById('todayTasksCount');
            const upcomingTasksCount = document.getElementById('upcomingTasksCount');
            const completedTasksCount = document.getElementById('completedTasksCount');
            const personalTasksCount = document.getElementById('personalTasksCount');
            const workTasksCount = document.getElementById('workTasksCount');
            const settingsPanel = document.getElementById('settingsPanel');
            const settingsClose = document.getElementById('settingsClose');
            const openSettings = document.getElementById('openSettings');
            const sortTasks = document.getElementById('sortTasks');
            const filterPriority = document.getElementById('filterPriority');
            const filterTags = document.getElementById('filterTags');
            const exportData = document.getElementById('exportData');
            const exportTemplate = document.getElementById('exportTemplate');
            const importData = document.getElementById('importData');
            const importTemplate = document.getElementById('importTemplate');
            const clearData = document.getElementById('clearData');
            const restoreBackup = document.getElementById('restoreBackup');
            const tagSuggestions = document.getElementById('tagSuggestions');

            let appData = {
                tasks: JSON.parse(localStorage.getItem('tasks')) || [],
                tags: JSON.parse(localStorage.getItem('tags')) || [],
                currentCategory: 'all',
                currentList: 'all',
                theme: localStorage.getItem('theme') || 'light',
                sortBy: 'none',
                filterPriority: 'all',
                filterTags: 'all',
                usageData: JSON.parse(localStorage.getItem('usageData')) || {
                    lastActiveDate: null,
                    streak: 0,
                    totalCompleted: 0,
                    totalAdded: 0,
                    daysUsed: 0
                },
                lastBackup: localStorage.getItem('backup') || null
            };

            // Initialize
            document.body.className = appData.theme === 'light' ? '' : 'dark-mode';
            themeToggle.textContent = appData.theme === 'light' ? '🌙' : '☀️';
            checkAuth();
            updateGreeting();
            renderTasks();
            updateAllCounts();
            updateStats();
            updateTagSuggestions();
            checkOverdueTasks();

            function saveData() {
                appData.lastBackup = JSON.stringify(appData.tasks);
                localStorage.setItem('tasks', JSON.stringify(appData.tasks));
                localStorage.setItem('tags', JSON.stringify(appData.tags));
                localStorage.setItem('theme', appData.theme);
                localStorage.setItem('usageData', JSON.stringify(appData.usageData));
                localStorage.setItem('backup', appData.lastBackup);
            }

            function checkAuth() {
                const isSignedIn = localStorage.getItem('isSignedIn') === 'true';
                if (isSignedIn) {
                    frontPage.style.display = 'none';
                    dashboard.style.display = 'flex';
                    const today = new Date().toISOString().split('T')[0];
                    if (appData.usageData.lastActiveDate !== today) {
                        if (appData.usageData.lastActiveDate && 
                            new Date(appData.usageData.lastActiveDate).getTime() + 86400000 > new Date(today).getTime()) {
                            appData.usageData.streak += 1;
                        } else {
                            appData.usageData.streak = 1;
                        }
                        appData.usageData.lastActiveDate = today;
                        appData.usageData.daysUsed += 1;
                        saveData();
                    }
                } else {
                    frontPage.style.display = 'flex';
                    dashboard.style.display = 'none';
                }
            }

            function signIn() {
                localStorage.setItem('isSignedIn', 'true');
                const randomInitial = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                userAvatar.textContent = randomInitial;
                const today = new Date().toISOString().split('T')[0];
                if (!appData.usageData.lastActiveDate) {
                    appData.usageData = {
                        lastActiveDate: today,
                        streak: 1,
                        totalCompleted: 0,
                        totalAdded: 0,
                        daysUsed: 1
                    };
                }
                saveData();
                checkAuth();
            }

            function updateGreeting() {
                const hour = new Date().getHours();
                greetingText.textContent = hour < 12 ? 'Good Morning!' : hour < 18 ? 'Good Afternoon!' : 'Good Evening!';
            }

            function updateProductivityLevel() {
                const completedToday = appData.tasks.filter(task => 
                    task.completed && new Date(task.createdAt).toDateString() === new Date().toDateString()).length;
                productivityLevel.textContent = completedToday >= 5 ? 'super productive' : completedToday >= 2 ? 'very productive' : 'getting there';
            }

            function updateStats() {
                const totalTasks = appData.tasks.length;
                const completedTasks = appData.tasks.filter(task => task.completed).length;
                const completion = totalTasks ? Math.round((completedTasks / totalTasks) * 100) : 0;
                completionRate.textContent = `${completion}%`;
                completionBar.style.width = `${completion}%`;
                const daysUsed = appData.usageData.daysUsed || 1;
                dailyAverage.textContent = `${Math.round(appData.usageData.totalCompleted / daysUsed)} tasks`;
                streakCount.textContent = `${appData.usageData.streak} days`;
            }

            function updateAllCounts() {
                const today = new Date().toISOString().split('T')[0];
                allTasksCount.textContent = appData.tasks.length;
                todayTasksCount.textContent = appData.tasks.filter(task => task.dueDate === today).length;
                upcomingTasksCount.textContent = appData.tasks.filter(task => task.dueDate && new Date(task.dueDate) > new Date()).length;
                completedTasksCount.textContent = appData.tasks.filter(task => task.completed).length;
                personalTasksCount.textContent = appData.tasks.filter(task => task.category === 'personal').length;
                workTasksCount.textContent = appData.tasks.filter(task => task.category === 'work').length;
                pendingCount.textContent = appData.tasks.filter(task => !task.completed).length;
            }

            function updateTagSuggestions() {
                tagSuggestions.innerHTML = appData.tags.map(tag => `<option value="${tag}">`).join('');
                filterTags.innerHTML = '<option value="all">All</option>' + appData.tags.map(tag => `<option value="${tag}">${tag}</option>`).join('');
            }

            function checkOverdueTasks() {
                appData.tasks.forEach(task => {
                    if (task.dueDate && new Date(task.dueDate) < new Date() && !task.completed) {
                        setTimeout(() => alert(`Reminder: Task "${task.text}" is overdue!`), 1000);
                    }
                });
            }

            function renderTasks() {
                let tasks = appData.tasks;
                if (appData.currentList === 'today') {
                    tasks = tasks.filter(task => task.dueDate === new Date().toISOString().split('T')[0]);
                } else if (appData.currentList === 'upcoming') {
                    tasks = tasks.filter(task => task.dueDate && new Date(task.dueDate) > new Date());
                } else if (appData.currentList === 'completed') {
                    tasks = tasks.filter(task => task.completed);
                } else if (appData.currentList !== 'all') {
                    tasks = tasks.filter(task => task.category === appData.currentList);
                }

                if (appData.currentCategory !== 'all') {
                    tasks = tasks.filter(task => task.category === appData.currentCategory);
                }

                if (appData.filterPriority !== 'all') {
                    tasks = tasks.filter(task => task.priority === appData.filterPriority);
                }

                if (appData.filterTags !== 'all') {
                    tasks = tasks.filter(task => task.tags.includes(appData.filterTags));
                }

                tasks = [...tasks].sort((a, b) => {
                    if (appData.sortBy === 'priority') {
                        const priorities = { high: 3, medium: 2, low: 1, none: 0 };
                        return priorities[b.priority] - priorities[a.priority];
                    } else if (appData.sortBy === 'due-date') {
                        return (a.dueDate || '9999-12-31').localeCompare(b.dueDate || '9999-12-31');
                    } else if (appData.sortBy === 'name') {
                        return a.text.localeCompare(b.text);
                    }
                    return 0;
                });

                taskDepends.innerHTML = '<option value="none">No Dependency</option>' + 
                    tasks.map(task => `<option value="${task.id}">${task.text}</option>`).join('');

                taskList.innerHTML = tasks.length ? '' : `
                    <div class="empty-state">
                        <h3>Your canvas is clear</h3>
                        <p>Add your first task by typing above.</p>
                    </div>
                `;

                tasks.forEach(task => {
                    const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && !task.completed;
                    const dependencies = task.dependsOn ? tasks.find(t => t.id === task.dependsOn) : null;
                    const canComplete = !task.dependsOn || (dependencies && dependencies.completed);

                    const taskItem = document.createElement('li');
                    taskItem.classList.add('task-item');
                    taskItem.draggable = true;
                    taskItem.dataset.taskId = task.id;
                    if (task.completed) taskItem.classList.add('completed');

                    taskItem.innerHTML = `
                        <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} ${!canComplete ? 'disabled' : ''} aria-label="Complete task ${task.text}">
                        <span class="task-text ${task.completed ? 'completed' : ''}" contenteditable="false">${task.text}</span>
                        <span class="task-category">${task.category}</span>
                        <div class="task-tags">${task.tags.map(tag => `<span class="task-tag">${tag}</span>`).join('')}</div>
                        <span class="task-duedate ${isOverdue ? 'overdue' : ''}" contenteditable="false">${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : ''}</span>
                        <div class="task-actions">
                            <button class="task-btn edit" title="Edit">✎</button>
                            <button class="task-btn toggle-details" title="Details">↓</button>
                            <button class="task-btn delete" title="Delete">×</button>
                        </div>
                        <div class="task-details">
                            <div class="task-notes" contenteditable="false">${task.notes}</div>
                            <ul class="subtask-list">
                                ${task.subtasks.map(subtask => `
                                    <li class="subtask-item">
                                        <input type="checkbox" ${subtask.completed ? 'checked' : ''} aria-label="Complete subtask ${subtask.name}">
                                        <span>${subtask.name}</span>
                                    </li>
                                `).join('')}
                            </ul>
                            <div class="add-subtask-container">
                                <input type="text" class="add-subtask-input" placeholder="Add subtask..." aria-label="New subtask">
                                <button class="add-subtask-btn">+</button>
                            </div>
                            ${task.dependsOn ? `<div class="task-dependencies">Depends on: <span>${dependencies ? dependencies.text : 'Deleted'}</span></div>` : ''}
                        </div>
                    `;
                    taskList.appendChild(taskItem);

                    const checkbox = taskItem.querySelector('.task-checkbox');
                    const text = taskItem.querySelector('.task-text');
                    const dueDate = taskItem.querySelector('.task-duedate');
                    const editBtn = taskItem.querySelector('.edit');
                    const toggleDetailsBtn = taskItem.querySelector('.toggle-details');
                    const deleteBtn = taskItem.querySelector('.delete');
                    const details = taskItem.querySelector('.task-details');
                    const notes = taskItem.querySelector('.task-notes');
                    const addSubtaskInput = taskItem.querySelector('.add-subtask-input');
                    const addSubtaskBtn = taskItem.querySelector('.add-subtask-btn');
                    const subtaskList = taskItem.querySelector('.subtask-list');
                    const tags = taskItem.querySelectorAll('.task-tag');

                    checkbox.addEventListener('change', () => {
                        if (canComplete) {
                            task.completed = checkbox.checked;
                            if (task.completed) appData.usageData.totalCompleted += 1;
                            renderTasks();
                            updateAllCounts();
                            updateStats();
                            updateProductivityLevel();
                            saveData();
                        } else {
                            checkbox.checked = false;
                            alert(`Cannot complete "${task.text}" until "${dependencies.text}" is completed.`);
                        }
                    });

                    text.addEventListener('dblclick', () => {
                        text.contentEditable = true;
                        text.focus();
                    });
                    text.addEventListener('blur', () => {
                        text.contentEditable = false;
                        task.text = text.textContent.trim();
                        saveData();
                    });

                    dueDate.addEventListener('dblclick', () => {
                        dueDate.contentEditable = true;
                        dueDate.focus();
                    });
                    dueDate.addEventListener('blur', () => {
                        dueDate.contentEditable = false;
                        const date = dueDate.textContent.trim();
                        if (date && !isNaN(new Date(date))) {
                            task.dueDate = new Date(date).toISOString().split('T')[0];
                        } else {
                            task.dueDate = '';
                        }
                        renderTasks();
                        saveData();
                    });

                    editBtn.addEventListener('click', () => {
                        text.contentEditable = true;
                        text.focus();
                        notes.contentEditable = true;
                    });

                    notes.addEventListener('blur', () => {
                        notes.contentEditable = false;
                        task.notes = notes.textContent.trim();
                        saveData();
                    });

                    toggleDetailsBtn.addEventListener('click', () => {
                        details.classList.toggle('open');
                        toggleDetailsBtn.textContent = details.classList.contains('open') ? '↑' : '↓';
                    });

                    deleteBtn.addEventListener('click', () => {
                        if (confirm(`Delete task "${task.text}"?`)) {
                            appData.tasks = appData.tasks.filter(t => t.id !== task.id);
                            renderTasks();
                            updateAllCounts();
                            updateStats();
                            saveData();
                        }
                    });

                    tags.forEach(tag => {
                        tag.addEventListener('click', () => {
                            appData.filterTags = tag.textContent;
                            filterTags.value = appData.filterTags;
                            renderTasks();
                            saveData();
                        });
                    });

                    addSubtaskBtn.addEventListener('click', () => {
                        const subtaskName = addSubtaskInput.value.trim();
                        if (subtaskName) {
                            task.subtasks.push({ name: subtaskName, completed: false });
                            addSubtaskInput.value = '';
                            renderTasks();
                            saveData();
                        }
                    });

                    subtaskList.addEventListener('change', (e) => {
                        if (e.target.type === 'checkbox') {
                            const subtaskIndex = Array.from(subtaskList.children).indexOf(e.target.parentElement);
                            task.subtasks[subtaskIndex].completed = e.target.checked;
                            saveData();
                            renderTasks();
                        }
                    });

                    taskItem.addEventListener('dragstart', () => {
                        taskItem.classList.add('dragging');
                    });
                    taskItem.addEventListener('dragend', () => {
                        taskItem.classList.remove('dragging');
                        const taskItems = Array.from(taskList.children);
                        const newTasks = taskItems.map(item => appData.tasks.find(t => t.id === Number(item.dataset.taskId)));
                        appData.tasks = newTasks;
                        saveData();
                    });
                });

                taskList.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const dragging = document.querySelector('.dragging');
                    const afterElement = getDragAfterElement(taskList, e.clientY);
                    if (afterElement == null) {
                        taskList.appendChild(dragging);
                    } else {
                        taskList.insertBefore(dragging, afterElement);
                    }
                });
            }

            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    }
                    return closest;
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }

            signInBtn.addEventListener('click', signIn);

            addTaskBtn.addEventListener('click', () => {
                if (taskInput.value.trim()) {
                    const tags = taskTags.value.split(',').map(tag => tag.trim()).filter(tag => tag);
                    tags.forEach(tag => {
                        if (tag && !appData.tags.includes(tag)) appData.tags.push(tag);
                    });
                    const newTask = {
                        id: Date.now(),
                        text: taskInput.value.trim(),
                        completed: false,
                        category: appData.currentCategory,
                        createdAt: new Date().toISOString(),
                        dueDate: taskDueDate.value,
                        priority: taskPriority.value,
                        tags,
                        notes: '',
                        subtasks: [],
                        dependsOn: taskDepends.value !== 'none' ? Number(taskDepends.value) : null
                    };
                    appData.tasks.unshift(newTask);
                    appData.usageData.totalAdded += 1;
                    taskInput.value = '';
                    taskTags.value = '';
                    taskDueDate.value = '';
                    taskPriority.value = 'none';
                    taskDepends.value = 'none';
                    updateTagSuggestions();
                    renderTasks();
                    updateAllCounts();
                    updateStats();
                    updateProductivityLevel();
                    saveData();
                }
            });

            taskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTaskBtn.click();
            });

            themeToggle.addEventListener('click', () => {
                appData.theme = appData.theme === 'light' ? 'dark' : 'light';
                document.body.className = appData.theme === 'light' ? '' : 'dark-mode';
                themeToggle.textContent = appData.theme === 'light' ? '🌙' : '☀️';
                saveData();
            });

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    appData.currentList = link.dataset.category;
                    taskList.classList.add('fade');
                    setTimeout(() => {
                        renderTasks();
                        taskList.classList.remove('fade');
                    }, 300);
                });
            });

            categoryBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    appData.currentCategory = btn.dataset.category;
                    renderTasks();
                });
            });

            openSettings.addEventListener('click', () => {
                settingsPanel.classList.add('open');
            });

            settingsClose.addEventListener('click', () => {
                settingsPanel.classList.remove('open');
            });

            sortTasks.addEventListener('change', () => {
                appData.sortBy = sortTasks.value;
                renderTasks();
                saveData();
            });

            filterPriority.addEventListener('change', () => {
                appData.filterPriority = filterPriority.value;
                renderTasks();
                saveData();
            });

            filterTags.addEventListener('change', () => {
                appData.filterTags = filterTags.value;
                renderTasks();
                saveData();
            });

            exportData.addEventListener('click', () => {
                const dataStr = JSON.stringify(appData.tasks);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'flowtask-data.json';
                a.click();
                URL.revokeObjectURL(url);
            });

            exportTemplate.addEventListener('click', () => {
                const template = { categories: ['all', 'personal', 'work', 'shopping', 'health', 'learning', 'other'] };
                const dataStr = JSON.stringify(template);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'flowtask-template.json';
                a.click();
                URL.revokeObjectURL(url);
            });

            importData.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            appData.tasks = JSON.parse(event.target.result);
                            renderTasks();
                            updateAllCounts();
                            updateStats();
                            updateTagSuggestions();
                            saveData();
                        } catch (err) {
                            alert('Invalid data file.');
                        }
                    };
                    reader.readAsText(file);
                }
            });

            importTemplate.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const template = JSON.parse(event.target.result);
                            appData.currentCategory = template.categories.includes(appData.currentCategory) ? appData.currentCategory : 'all';
                            renderTasks();
                            saveData();
                        } catch (err) {
                            alert('Invalid template file.');
                        }
                    };
                    reader.readAsText(file);
                }
            });

            clearData.addEventListener('click', () => {
                if (confirm('Clear all data? This cannot be undone.')) {
                    appData.tasks = [];
                    appData.tags = [];
                    appData.usageData = { lastActiveDate: null, streak: 0, totalCompleted: 0, totalAdded: 0, daysUsed: 0 };
                    renderTasks();
                    updateAllCounts();
                    updateStats();
                    updateTagSuggestions();
                    saveData();
                }
            });

            restoreBackup.addEventListener('click', () => {
                if (appData.lastBackup && confirm('Restore last backup? Current data will be overwritten.')) {
                    appData.tasks = JSON.parse(appData.lastBackup);
                    renderTasks();
                    updateAllCounts();
                    updateStats();
                    saveData();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.contentEditable === 'true') return;
                if (e.key === 'n') {
                    taskInput.focus();
                } else if (e.key === 't') {
                    themeToggle.click();
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    const focusable = [taskInput, taskTags, taskDueDate, taskPriority, taskDepends, addTaskBtn, openSettings].filter(el => !el.disabled);
                    const current = document.activeElement;
                    const index = focusable.indexOf(current);
                    const next = focusable[index + 1] || focusable[0];
                    next.focus();
                }
            });
        })();
    </script>
</body>
</html>
